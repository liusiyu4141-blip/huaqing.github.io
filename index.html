<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hua Qing | Fine Art of Gongbi</title>
  <meta name="description" content="Discover the timeless serenity of Chinese Gongbi painting by Hua Qing. Hand-painted masterpieces on silk.">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+XiaoWei&family=Noto+Serif+SC:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --paper-bg:#fdfbf7;
      --ink-black:#2c2c2c;
      --seal-red:#a83f39;
      --jade-green:#687e75;
    }
    body{
      background-color:var(--paper-bg);
      color:var(--ink-black);
      font-family:'Playfair Display','KaiTi',serif;
      background-image:url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    }
    .font-calligraphy{font-family:'Ma Shan Zheng',cursive;}
    .font-song-art{font-family:'ZCOOL XiaoWei',serif;}
    .font-serif-text{font-family:'Noto Serif SC',serif;}

    ::-webkit-scrollbar{width:8px;}
    ::-webkit-scrollbar-track{background:#f1f1f1;}
    ::-webkit-scrollbar-thumb{background:#ccc;border-radius:4px;}

    .seal{
      display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;
      background-color:var(--seal-red);color:#fff;border-radius:4px;font-size:18px;
      border:2px solid #8a2e29;box-shadow:2px 2px 4px rgba(0,0,0,0.2);
      font-family:'Ma Shan Zheng',cursive;line-height:1;padding-top:4px;
    }
    .loader{
      border:3px solid #f3f3f3;border-radius:50%;border-top:3px solid #a83f39;
      width:24px;height:24px;animation:spin 1s linear infinite;display:inline-block;
    }
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

    .nav-link{position:relative;}
    .nav-link::after{
      content:'';position:absolute;width:0;height:1px;bottom:0;left:50%;
      background-color:#a83f39;transition:all .3s ease;transform:translateX(-50%);
    }
    .nav-link:hover::after{width:80%;}

    .drop-zone{border:2px dashed #a83f39;background:#fff5f5;transition:all .3s;}
    .drop-zone.dragover{background:#ffe0e0;border-color:red;}

    /* Responsive video container (fits any aspect ratio) */
    .yt-wrap{
      position:relative;width:100%;
      aspect-ratio: 9 / 16; /* Shorts default */
      background:#000;border-radius: 12px;
      overflow:hidden;
    }
    @media (min-width: 1024px){
      .yt-wrap{ aspect-ratio: 16 / 9; } /* on desktop, make it wider */
    }
    .yt-wrap iframe{
      position:absolute;inset:0;width:100%;height:100%;
      border:0;
    }

    /* admin UI toggles */
    .admin-only{display:none;}
    body.is-admin .admin-only{display:block;}
  </style>
</head>

<body class="antialiased">

  <!-- NAV -->
  <nav class="fixed w-full z-50 bg-[#fdfbf7]/90 backdrop-blur-sm border-b border-stone-200 transition-all duration-300" id="navbar">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-20">

        <div class="flex-shrink-0 flex items-center gap-4">
          <div class="seal" data-i18n="seal">Hua</div>
          <span class="text-xl tracking-widest text-stone-800 font-bold pt-1">HUA QING ART</span>
        </div>

        <div class="hidden md:flex space-x-8 items-center">
          <a href="#home" class="nav-link text-stone-600 hover:text-stone-900 px-1 py-2 text-sm uppercase tracking-widest transition-colors" data-i18n="nav.home">Home</a>
          <a href="#about-gongbi" class="nav-link text-stone-600 hover:text-stone-900 px-1 py-2 text-sm uppercase tracking-widest transition-colors" data-i18n="nav.source">The Craft</a>
          <a href="#artist" class="nav-link text-stone-600 hover:text-stone-900 px-1 py-2 text-sm uppercase tracking-widest transition-colors" data-i18n="nav.artist">Artist</a>
          <a href="#gallery" class="nav-link text-stone-600 hover:text-stone-900 px-1 py-2 text-sm uppercase tracking-widest transition-colors" data-i18n="nav.gallery">Gallery</a>
          <a href="#contact" class="bg-stone-800 text-stone-100 px-6 py-2 text-xs uppercase tracking-widest hover:bg-[#a83f39] transition-colors duration-300 shadow-lg" data-i18n="nav.contact">Collect</a>

          <button onclick="window.toggleLanguage()" class="ml-4 text-xs font-bold border border-stone-300 px-3 py-1 rounded hover:border-[#a83f39] hover:text-[#a83f39] transition-colors font-serif">
            <span id="lang-btn-text">中</span>
          </button>

          <!-- Auth UI (wired in Part 2) -->
          <div id="user-auth-section" class="ml-2">
            <button onclick="window.openAuthModal('login')" class="flex items-center gap-2 text-stone-600 hover:text-[#a83f39]">
              <i data-lucide="user" class="w-5 h-5"></i>
              <span id="user-name-display" class="text-xs uppercase">Sign In</span>
            </button>
          </div>
        </div>

        <div class="md:hidden flex items-center gap-4">
          <button onclick="window.toggleLanguage()" class="text-xs font-bold border border-stone-300 px-2 py-1 rounded">
            <span id="lang-btn-text-mobile">中</span>
          </button>
          <button id="mobile-menu-btn" class="text-stone-600 hover:text-stone-900 focus:outline-none">
            <i data-lucide="menu" class="w-6 h-6"></i>
          </button>
        </div>

      </div>
    </div>

    <div id="mobile-menu" class="hidden md:hidden bg-[#fdfbf7] border-b border-stone-200">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 text-center">
        <a href="#home" class="block px-3 py-2 text-stone-600 hover:text-[#a83f39] font-serif text-lg" data-i18n="nav.home">Home</a>
        <a href="#about-gongbi" class="block px-3 py-2 text-stone-600 hover:text-[#a83f39] font-serif text-lg" data-i18n="nav.source">The Craft</a>
        <a href="#artist" class="block px-3 py-2 text-stone-600 hover:text-[#a83f39] font-serif text-lg" data-i18n="nav.artist">Artist</a>
        <a href="#gallery" class="block px-3 py-2 text-stone-600 hover:text-[#a83f39] font-serif text-lg" data-i18n="nav.gallery">Gallery</a>
        <button onclick="window.openAuthModal('login')" class="block w-full px-3 py-2 text-stone-600 hover:text-[#a83f39] text-center font-serif text-lg">Sign In</button>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <section id="home" class="relative h-screen flex items-center justify-center overflow-hidden">
    <div class="absolute inset-0 z-0">
      <img src="https://images.unsplash.com/photo-1695519895085-c13f63810486?q=80&w=2574&auto=format&fit=crop" alt="Background Texture" class="w-full h-full object-cover opacity-20">
      <div class="absolute inset-0 bg-gradient-to-b from-[#fdfbf7] via-transparent to-[#fdfbf7]"></div>
    </div>

    <div class="relative z-10 text-center flex flex-col items-center p-6 w-full px-4">
      <h2 class="text-[#a83f39] text-sm md:text-base tracking-[0.3em] md:tracking-[0.5em] mb-6 uppercase font-bold" data-i18n="hero.subtitle">The Ancient Art of Gongbi</h2>
      <h1 class="text-4xl sm:text-5xl md:text-7xl mb-8 text-stone-800 font-serif italic tracking-wide whitespace-nowrap" data-i18n="hero.title">
        Timeless Serenity, Painted in Silk
      </h1>
      <p class="text-lg md:text-2xl text-stone-600 font-light italic mb-12" data-i18n="hero.desc">"Where the microscopic world meets infinite mindfulness."</p>

      <a href="#gallery" class="group relative inline-flex items-center justify-center px-10 py-4 overflow-hidden font-medium text-stone-600 border border-stone-400 rounded-full transition duration-300 ease-out hover:border-[#a83f39] hover:text-[#a83f39]">
        <span class="absolute inset-0 flex items-center justify-center w-full h-full text-white duration-300 -translate-x-full bg-[#a83f39] group-hover:translate-x-0 ease">
          <i data-lucide="arrow-right" class="w-6 h-6"></i>
        </span>
        <span class="absolute flex items-center justify-center w-full h-full text-stone-600 transition-all duration-300 transform group-hover:translate-x-full ease font-serif text-lg uppercase tracking-widest" data-i18n="hero.button">Explore Collection</span>
        <span class="relative invisible font-serif text-lg" data-i18n="hero.button">Explore Collection</span>
      </a>
    </div>

    <div class="absolute bottom-10 right-10 opacity-60 hidden md:block">
      <div class="border-2 border-[#a83f39] p-2 inline-block transform rotate-3">
        <div class="bg-[#a83f39] text-white p-3 text-2xl writing-mode-vertical font-calligraphy" data-i18n="hero.seal">Hua Qing</div>
      </div>
    </div>
  </section>

  <!-- ABOUT GONGBI -->
  <section id="about-gongbi" class="py-24 bg-stone-100/50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">

        <!-- Video -->
        <div class="order-2 lg:order-1 relative group">
          <div class="absolute -top-4 -left-4 w-full h-full border border-stone-300 z-0"></div>

          <div class="relative z-10 shadow-lg w-full bg-black rounded-xl overflow-hidden">
            <div id="about-video-wrap" class="yt-wrap">
              <!-- Default: your shorts (loop + autoplay + mute) -->
              <iframe
                id="about-video-iframe"
                src="https://www.youtube.com/embed/zN0VzZRzlqM?autoplay=1&mute=1&loop=1&playlist=zN0VzZRzlqM&controls=0&playsinline=1&modestbranding=1&rel=0"
                allow="autoplay; encrypted-media"
                title="Hua Qing Intro Video"
              ></iframe>
            </div>
          </div>

          <!-- Admin change video (wired in Part 2) -->
          <div class="absolute top-2 right-2 z-20 admin-only">
            <button onclick="window.adminEditAboutVideo()" class="bg-black/70 text-white p-2 rounded hover:bg-[#a83f39] transition-colors flex items-center gap-2 text-xs">
              <i data-lucide="edit"></i> Change Video
            </button>
          </div>
        </div>

        <!-- Text -->
        <div class="order-1 lg:order-2">
          <div class="flex items-center gap-4 mb-6">
            <div class="h-px w-16 bg-[#a83f39]"></div>
            <span class="text-[#a83f39] uppercase tracking-widest text-sm font-bold" data-i18n="gongbi.label">The Craft</span>
          </div>

          <h2 class="text-4xl md:text-5xl font-serif mb-8 text-stone-800 italic" data-i18n="gongbi.title">
            Origins, Precision, Stillness
          </h2>

          <div class="space-y-6 text-stone-600 text-lg leading-loose font-serif-text">
            <p data-i18n="gongbi.p1"></p>
            <p data-i18n="gongbi.p2"></p>
            <p class="italic text-stone-500" data-i18n="gongbi.p3"></p>
          </div>

          <ul class="space-y-4 font-serif text-lg mt-8">
            <li class="flex items-center gap-3">
              <i data-lucide="feather" class="text-[#a83f39] w-5 h-5 flex-shrink-0"></i>
              <span class="text-stone-700" data-i18n="gongbi.list1"></span>
            </li>
            <li class="flex items-center gap-3">
              <i data-lucide="droplets" class="text-[#a83f39] w-5 h-5 flex-shrink-0"></i>
              <span class="text-stone-700" data-i18n="gongbi.list2"></span>
            </li>
          </ul>

        </div>
      </div>
    </div>
  </section>

  <!-- ARTIST -->
  <section id="artist" class="py-24">
    <div class="max-w-5xl mx-auto px-4 text-center">

      <div class="mb-12 inline-block relative group">
        <!-- Avatar -->
        <div id="artist-img-container"
             class="relative w-40 h-40 mx-auto mb-6 rounded-full overflow-hidden border-4 border-white shadow-xl cursor-pointer"
             title="Admin: drag & drop to update (after Part 3)"
        >
          <img id="artist-img"
               src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=2488&auto=format&fit=crop"
               alt="Artist Portrait"
               class="w-full h-full object-cover">
          <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity admin-only">
            <span class="text-white text-xs px-2">Admin: Drag & Drop to Update</span>
          </div>
        </div>

        <h2 class="text-5xl font-serif text-stone-800 mb-2 italic" data-i18n="artist.name">Hua Qing</h2>
        <p class="text-[#a83f39] font-sans text-xs uppercase tracking-[0.3em]" data-i18n="artist.title">Contemporary Gongbi Artist</p>
      </div>

      <div class="prose prose-stone mx-auto text-xl leading-loose text-stone-600 max-w-3xl font-serif-text">
        <p data-i18n="artist.bio1" class="mb-6"></p>
        <p data-i18n="artist.bio2"></p>
      </div>

      <div class="mt-12 flex justify-center gap-16">
        <div class="text-center">
          <span class="block text-5xl font-serif font-bold text-stone-800">20+</span>
          <span class="text-xs text-stone-500 tracking-widest uppercase mt-2" data-i18n="artist.stat1">Years</span>
        </div>
        <div class="text-center">
          <span class="block text-5xl font-serif font-bold text-stone-800">28</span>
          <span class="text-xs text-stone-500 tracking-widest uppercase mt-2" data-i18n="artist.stat2">Exhibitions</span>
        </div>
        <div class="text-center">
          <span class="block text-5xl font-serif font-bold text-stone-800">100+</span>
          <span class="text-xs text-stone-500 tracking-widest uppercase mt-2" data-i18n="artist.stat3">Collections</span>
        </div>
      </div>

    </div>
  </section>

  <!-- GALLERY -->
  <section id="gallery" class="py-24 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <span class="text-[#a83f39] uppercase tracking-widest text-xs font-bold block mb-3" data-i18n="gallery.label">Curated Collection</span>
        <h2 class="text-5xl font-serif text-stone-800 italic" data-i18n="gallery.title">Ink & Rhythm</h2>
      </div>

      <!-- Filters -->
      <div class="flex justify-center gap-8 mb-12 text-sm text-stone-500 uppercase tracking-widest font-sans">
        <button onclick="window.filterGallery('all')" class="text-[#a83f39] border-b border-[#a83f39] pb-1 filter-btn" data-filter="all" data-i18n="gallery.filter.all">All Works</button>
        <button onclick="window.filterGallery('flower')" class="hover:text-stone-800 transition-colors filter-btn" data-filter="flower" data-i18n="gallery.filter.flower">Flowers</button>
        <button onclick="window.filterGallery('animal')" class="hover:text-stone-800 transition-colors filter-btn" data-filter="animal" data-i18n="gallery.filter.animal">Animals</button>
        <button onclick="window.filterGallery('bird_flower')" class="hover:text-stone-800 transition-colors filter-btn" data-filter="bird_flower" data-i18n="gallery.filter.bird_flower">Birds & Flowers</button>
      </div>

      <!-- Admin add -->
      <div class="max-w-7xl mx-auto mb-8 flex justify-center admin-only">
        <button id="add-artwork-btn" onclick="window.openAddModal()" class="px-6 py-3 bg-[#a83f39] text-white rounded-full shadow hover:bg-red-800 transition flex items-center gap-2">
          <i data-lucide="plus"></i> <span data-i18n="admin.addWork">Add New Artwork</span>
        </button>
      </div>

      <!-- Grid (wired in Part 2/3) -->
      <div id="gallery-grid" class="columns-1 md:columns-2 lg:columns-3 gap-8 space-y-8 min-h-[400px]">
        <div class="col-span-full flex justify-center items-center h-40 w-full">
          <div class="loader"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="bg-stone-900 text-stone-200 py-24 relative overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-16">
        <div>
          <h2 class="text-4xl font-serif text-white mb-6 italic" data-i18n="contact.title">Acquire & Connect</h2>
          <p class="text-stone-400 mb-8 leading-relaxed font-serif-text text-lg" data-i18n="contact.desc"></p>

          <div class="space-y-6 font-sans">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 rounded-full bg-stone-800 flex items-center justify-center text-[#a83f39]"><i data-lucide="mail"></i></div>
              <div>
                <h4 class="text-white text-xs uppercase tracking-widest">Email</h4>
                <p class="text-stone-400 text-sm" id="contact-email">contact@huaqing-art.com</p>
              </div>
            </div>
            <div class="flex items-center gap-4">
              <a href="https://instagram.com" target="_blank" class="w-12 h-12 rounded-full bg-stone-800 flex items-center justify-center text-white hover:bg-[#a83f39] transition-colors duration-300">
                <i data-lucide="instagram"></i>
              </a>
              <div>
                <h4 class="text-white text-xs uppercase tracking-widest">Instagram</h4>
                <p class="text-stone-400 text-sm">@huaqing_gongbi</p>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-stone-800 p-8 rounded-lg shadow-2xl">
          <form onsubmit="event.preventDefault(); alert('Thank you. We will contact you shortly.');" class="space-y-6 font-sans">
            <div>
              <label class="block text-xs text-stone-400 mb-2 uppercase tracking-widest" data-i18n="form.name">Your Name</label>
              <input type="text" class="w-full bg-stone-700 border border-stone-600 text-white px-4 py-3 focus:outline-none focus:border-[#a83f39] transition-colors">
            </div>
            <div>
              <label class="block text-xs text-stone-400 mb-2 uppercase tracking-widest" data-i18n="form.email">Email Address</label>
              <input type="email" class="w-full bg-stone-700 border border-stone-600 text-white px-4 py-3 focus:outline-none focus:border-[#a83f39] transition-colors">
            </div>
            <div>
              <label class="block text-xs text-stone-400 mb-2 uppercase tracking-widest" data-i18n="form.message">Inquiry / Message</label>
              <textarea rows="4" class="w-full bg-stone-700 border border-stone-600 text-white px-4 py-3 focus:outline-none focus:border-[#a83f39] transition-colors"></textarea>
            </div>
            <button type="submit" class="w-full bg-[#a83f39] text-white py-4 uppercase tracking-widest hover:bg-red-800 transition-colors text-xs font-bold" data-i18n="form.submit">
              Send Inquiry
            </button>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-stone-950 text-stone-600 py-12 text-center text-sm border-t border-stone-900 relative">
    <p class="mb-2 font-serif">&copy; 2024 Hua Qing Art. All rights reserved.</p>
    <p class="font-serif italic text-xs mb-8" data-i18n="footer.tagline">Designed for the beauty of tranquility.</p>

    <div class="mt-4 flex items-center justify-center gap-3">
      <button onclick="window.openAdminModal()" class="text-stone-600 hover:text-stone-400 text-[10px] font-sans border border-stone-800 px-3 py-1 rounded transition-colors uppercase tracking-widest">
        Admin Access
      </button>
      <span id="admin-badge" class="hidden text-[10px] text-[#a83f39] uppercase tracking-widest font-sans">Admin Enabled</span>
    </div>
  </footer>

  <!-- AUTH MODAL -->
  <div id="authModal" class="fixed inset-0 z-[80] hidden bg-black/80 flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-lg max-w-sm w-full shadow-2xl relative">
      <button onclick="window.closeModalById('authModal')" class="absolute top-4 right-4 text-stone-500 hover:text-black">
        <i data-lucide="x" class="w-6 h-6"></i>
      </button>

      <div class="flex justify-center gap-6 mb-6 font-serif border-b border-stone-200 pb-2">
        <button onclick="window.switchAuthTab('login')" id="tab-login" class="text-xl font-bold text-[#a83f39] border-b-2 border-[#a83f39] pb-1 transition-colors">Login</button>
        <button onclick="window.switchAuthTab('register')" id="tab-register" class="text-xl text-stone-400 hover:text-stone-600 pb-1 transition-colors">Register</button>
      </div>

      <!-- Login -->
      <div id="form-login" class="space-y-4">
        <input type="email" id="login-email" class="w-full border border-stone-300 p-2 rounded font-serif text-sm" placeholder="Email">
        <input type="password" id="login-password" class="w-full border border-stone-300 p-2 rounded font-serif text-sm" placeholder="Password">
        <button onclick="window.authLogin()" class="w-full bg-[#a83f39] text-white py-2 rounded font-serif hover:bg-red-800">Sign In</button>
        <p class="text-[12px] text-stone-500 font-serif-text leading-relaxed" data-i18n="auth.tip">
          Tip: Please register first if you don’t have an account.
        </p>
      </div>

      <!-- Register -->
      <div id="form-register" class="space-y-4 hidden">
        <input type="text" id="reg-nickname" class="w-full border border-stone-300 p-2 rounded font-serif text-sm" placeholder="Nickname (for comments)">
        <input type="email" id="reg-email" class="w-full border border-stone-300 p-2 rounded font-serif text-sm" placeholder="Email">
        <input type="password" id="reg-password" class="w-full border border-stone-300 p-2 rounded font-serif text-sm" placeholder="Password (6+ chars)">
        <button onclick="window.authRegister()" class="w-full bg-[#a83f39] text-white py-2 rounded font-serif hover:bg-red-800">Create Account</button>
        <p class="text-[12px] text-stone-500 font-serif-text leading-relaxed" data-i18n="auth.nicknote">
          We will store your email + nickname so the admin can manage users.
        </p>
      </div>
    </div>
  </div>

  <!-- ADMIN MODAL -->
  <div id="adminModal" class="fixed inset-0 z-[80] hidden bg-black/80 flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-lg max-w-md w-full shadow-2xl relative">
      <button onclick="window.closeModalById('adminModal')" class="absolute top-4 right-4 text-stone-500 hover:text-black">
        <i data-lucide="x" class="w-6 h-6"></i>
      </button>

      <h3 class="text-2xl font-bold text-stone-800 mb-2 text-center font-serif">Admin Access</h3>
      <p class="text-center text-sm text-stone-500 mb-6 font-serif-text" data-i18n="admin.desc">
        Enter the admin key to unlock upload / delete / edit controls.
      </p>

      <div class="space-y-3">
        <input type="password" id="admin-key" class="w-full border border-stone-300 p-2 rounded font-serif" placeholder="Key (qinghua666)">
        <button onclick="window.adminLogin()" class="w-full bg-stone-800 text-white py-2 rounded font-serif hover:bg-stone-900">
          Verify
        </button>
      </div>

      <div class="mt-6 hidden" id="admin-panel">
        <div class="border-t border-stone-200 pt-4 mt-4 space-y-3">
          <button onclick="window.openUserList()" class="w-full border border-stone-300 py-2 rounded font-serif hover:border-[#a83f39]">
            View Registered Users
          </button>
          <div id="user-list" class="hidden bg-stone-50 border border-stone-200 rounded p-3 max-h-40 overflow-y-auto text-xs font-sans"></div>
          <p class="text-[12px] text-stone-500 font-serif-text leading-relaxed">
            (User list / upload / delete will be fully wired after Part 2 & Part 3.)
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ADD ARTWORK MODAL -->
  <div id="addModal" class="fixed inset-0 z-[90] hidden bg-black/80 flex items-center justify-center p-4">
    <div class="bg-white p-6 rounded-lg max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-xl font-bold text-stone-800 font-serif" data-i18n="admin.addTitle">Add New Artwork</h3>
        <button onclick="window.closeModalById('addModal')" class="text-stone-500 hover:text-black">
          <i data-lucide="x"></i>
        </button>
      </div>

      <div class="space-y-3 font-serif">
        <input type="text" id="new-title-zh" placeholder="Chinese Title" class="w-full border p-2 rounded">
        <input type="text" id="new-title-en" placeholder="English Title" class="w-full border p-2 rounded">
        <input type="text" id="new-desc-zh" placeholder="Desc (CN): Size | Material" class="w-full border p-2 rounded">
        <input type="text" id="new-desc-en" placeholder="Desc (EN): Size | Material" class="w-full border p-2 rounded">

        <select id="new-category" class="w-full border p-2 rounded">
          <option value="flower">Flowers</option>
          <option value="animal">Animals</option>
          <option value="bird_flower">Birds & Flowers</option>
        </select>

        <div id="drop-area" class="drop-zone w-full h-32 flex flex-col items-center justify-center rounded cursor-pointer text-stone-400 text-xs p-2 relative bg-stone-50">
          <i data-lucide="images" class="w-8 h-8 mb-2 text-stone-300"></i>
          <p data-i18n="admin.dragHint">Drag & Drop Images Here (Storage)</p>
          <input type="file" id="fileElem" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/*" multiple>
        </div>

        <div id="upload-previews" class="flex gap-2 overflow-x-auto h-20 border border-stone-200 p-1 rounded"></div>

        <button onclick="window.publishArtwork()" class="w-full bg-[#a83f39] text-white py-2 rounded mt-2 hover:bg-red-800" data-i18n="admin.publish">
          Publish
        </button>
      </div>
    </div>
  </div>

  <!-- DETAILS MODAL (Artwork + comments/likes wired in Part 2) -->
  <div id="imgModal" class="fixed inset-0 z-[60] hidden bg-black/95 flex items-center justify-center p-4 overflow-y-auto">
    <button onclick="window.closeArtworkModal()" class="fixed top-6 right-6 text-white hover:text-[#a83f39] transition-colors z-[70]">
      <i data-lucide="x" class="w-10 h-10"></i>
    </button>

    <div class="max-w-7xl w-full flex flex-col lg:flex-row gap-8 items-start justify-center mt-10 mb-10">
      <div class="lg:w-2/3 w-full bg-stone-900/50 p-4 rounded min-h-[600px] max-h-[90vh] overflow-y-auto">
        <div id="modalImagesContainer" class="flex flex-col gap-6"></div>
      </div>

      <div class="text-white lg:w-1/3 w-full bg-stone-900/80 p-6 rounded-lg backdrop-blur-md h-fit">
        <div id="img-admin-edit-panel" class="hidden mb-6 p-4 bg-stone-800 rounded border border-[#a83f39]">
          <h4 class="text-[#a83f39] font-bold mb-3 font-serif">Admin Controls</h4>
          <select id="modal-status-select" class="w-full bg-stone-700 text-white p-2 rounded border border-stone-600 font-serif text-xs mb-2">
            <option value="Available">Available</option>
            <option value="Sold">Sold</option>
            <option value="Reserved">Reserved</option>
          </select>
          <div class="flex gap-2">
            <button onclick="window.updateArtworkStatus()" class="flex-1 bg-green-800 hover:bg-green-700 text-white py-1 px-2 rounded text-sm font-serif">Update Status</button>
            <button onclick="window.deleteArtwork()" class="flex-1 bg-red-800 hover:bg-red-700 text-white py-1 px-2 rounded text-sm font-serif">Delete</button>
          </div>
        </div>

        <h3 id="modalTitle" class="text-4xl mb-2 text-[#a83f39] font-serif italic tracking-wide"></h3>
        <p id="modalDesc" class="text-stone-300 text-lg font-serif italic mb-4"></p>
        <div id="modalStatus" class="inline-block px-3 py-1 bg-stone-800 text-sm tracking-widest font-serif mb-4"></div>

        <div class="mt-4 flex items-center gap-3">
          <button onclick="window.toggleLike()" class="flex items-center gap-2 bg-stone-800 hover:bg-stone-700 px-3 py-2 rounded text-sm font-serif">
            <i data-lucide="heart" class="w-4 h-4"></i> <span data-i18n="like">Like</span>
          </button>
          <span id="likeCount" class="text-sm text-stone-300 font-sans">0</span>
        </div>

        <div class="mt-8 border-t border-stone-700 pt-6">
          <h4 class="text-lg font-bold mb-4 font-serif" data-i18n="comments.title">Comments</h4>
          <div id="comments-list" class="space-y-4 max-h-[260px] overflow-y-auto mb-4 pr-2"></div>

          <div id="comment-form-container" class="flex gap-2">
            <input id="new-comment-input" type="text" placeholder="Share your thoughts..." class="flex-1 bg-stone-800 border border-stone-600 rounded px-3 py-2 text-sm text-white">
            <button onclick="window.postComment()" class="bg-[#a83f39] text-white px-4 py-2 rounded text-sm font-serif hover:bg-red-800" data-i18n="comments.post">Post</button>
          </div>

          <p id="comment-login-tip" class="hidden text-[12px] text-stone-400 mt-3 font-serif-text" data-i18n="comments.loginTip">
            Please sign in to comment.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- ========= PART 1 SCRIPT: UI + I18N ONLY (Firebase wired in Part 2/3) ========= -->
  <script>
    // Mobile menu
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('mobile-menu-btn');
      const menu = document.getElementById('mobile-menu');
      if(btn && menu){
        btn.addEventListener('click', () => menu.classList.toggle('hidden'));
      }
      lucide.createIcons();
    });

    // i18n
    let currentLang = localStorage.getItem('huaqing_lang') || 'en';

    const i18n = {
      zh: {
        "seal":"花青",
        "nav.home":"首页",
        "nav.source":"工笔之源",
        "nav.artist":"关于画家",
        "nav.gallery":"作品赏析",
        "nav.contact":"收藏/联系",

        "hero.subtitle":"工笔画艺术",
        "hero.title":"尽精微 · 致广大",
        "hero.desc":"“于静谧中见乾坤，于细微处见广大。”",
        "hero.button":"进入画廊",
        "hero.seal":"花青",

        "gongbi.label":"关于工笔",
        "gongbi.title":"起源 · 兴盛 · 鼎盛",
        "gongbi.p1":"工笔画起源于战国至两汉时期（公元前475年—公元220年），早期见于帛画与壁画之中，强调以线造型、设色谨严，为后世“以线立骨”的体系奠基。",
        "gongbi.p2":"魏晋南北朝（220–589年）时期，人物画与佛教绘画的发展进一步推动工笔技法的成熟；唐代（618–907年）工笔人物与花鸟画趋于规范化，线描与设色的传统逐步确立。",
        "gongbi.p3":"宋代（960–1279年）是工笔画的巅峰。宋徽宗赵佶设立翰林图画院，提倡“格物致知”，追求极致写实与诗性统一。宋代工笔花鸟以严谨结构、精微设色与静谧气质，成为中国绘画史上最重要的美学典范之一。",
        "gongbi.list1":"<strong>骨法用笔：</strong> 以铁线描、游丝描等线法建立形与神",
        "gongbi.list2":"<strong>层层设色：</strong> 分染、罩染、统染反复叠加，色泽温润持久",

        "artist.name":"花青",
        "artist.title":"当代工笔画家",
        "artist.bio1":"花青，工笔花鸟创作者。她长期研习宋元工笔的线性结构与设色体系，并在当代语境中重建“静”的审美：不追求喧哗的视觉刺激，而是在克制的构图与细密的笔触中，让观看回到呼吸与停顿。",
        "artist.bio2":"她常以竹、荷、禽鸟等意象为线索，关注自然在季节与光影中的微小变化。作品强调“清、雅、缓、净”的气质：既保留传统工笔的秩序与工整，也让画面留出余白，使观者在安静里与自己相遇。",
        "artist.stat1":"年艺术生涯",
        "artist.stat2":"次展览经历",
        "artist.stat3":"私人收藏",

        "gallery.label":"精选作品",
        "gallery.title":"墨韵流芳",
        "gallery.filter.all":"全部",
        "gallery.filter.flower":"花",
        "gallery.filter.animal":"动物",
        "gallery.filter.bird_flower":"花鸟",

        "contact.title":"收藏与联络",
        "contact.desc":"若您对作品感兴趣，或有定制/合作需求，欢迎联系。期待与您分享工笔画的静谧之美。",

        "form.name":"姓名",
        "form.email":"邮箱",
        "form.message":"留言",
        "form.submit":"发送留言",

        "footer.tagline":"于静谧中见乾坤",

        "auth.tip":"提示：若没有账号，请先注册。",
        "auth.nicknote":"我们会保存你的邮箱 + 昵称，便于后台管理与评论显示。",

        "admin.desc":"输入管理员口令以解锁上传/删除/编辑功能。",
        "admin.addWork":"添加新作品",
        "admin.addTitle":"添加新作品",
        "admin.dragHint":"拖拽上传图片（Storage）",
        "admin.publish":"发布作品",

        "like":"点赞",
        "comments.title":"评论",
        "comments.post":"发布",
        "comments.loginTip":"请先登录后再评论。"
      },
      en: {
        "seal":"Hua",
        "nav.home":"Home",
        "nav.source":"The Craft",
        "nav.artist":"Artist",
        "nav.gallery":"Gallery",
        "nav.contact":"Collect",

        "hero.subtitle":"The Art of Gongbi",
        "hero.title":"Timeless Serenity, Painted in Silk",
        "hero.desc":"“Where the microscopic world meets infinite mindfulness.”",
        "hero.button":"Explore Collection",
        "hero.seal":"Hua Qing",

        "gongbi.label":"The Craft",
        "gongbi.title":"Origins · Flourish · Pinnacle",
        "gongbi.p1":"Gongbi painting originated during the Warring States and Han Dynasties (c. 475 BCE – 220 CE). Early examples appeared in silk paintings and murals, where disciplined linework and controlled coloration laid the foundation for later Gongbi traditions.",
        "gongbi.p2":"In the Wei–Jin and Northern–Southern Dynasties (220–589 CE), the development of figure painting and Buddhist art further refined Gongbi techniques. By the Tang Dynasty (618–907 CE), Gongbi became increasingly systematized, with formal conventions of line and color firmly established.",
        "gongbi.p3":"The art reached its pinnacle in the Song Dynasty (960–1279 CE). Emperor Huizong founded the Imperial Painting Academy and advocated *gewu zhizhi*—the pursuit of truth through careful observation. Song Gongbi flower-and-bird paintings are celebrated for their precision, restraint, and poetic stillness, forming a major aesthetic legacy in Chinese art history.",
        "gongbi.list1":"<strong>Structure by line:</strong> hair-thin strokes define form and spirit",
        "gongbi.list2":"<strong>Color by layers:</strong> repeated washes create depth and lasting radiance",

        "artist.name":"Hua Qing",
        "artist.title":"Contemporary Gongbi Artist",
        "artist.bio1":"Hua Qing is a contemporary Gongbi artist whose practice is rooted in refined Song–Yuan traditions. Rather than pursuing spectacle, she rebuilds an aesthetic of stillness—where disciplined composition and delicate brushwork invite the viewer to slow down.",
        "artist.bio2":"Working with motifs such as bamboo, lotus, and birds, she pays attention to subtle shifts of season, light, and air. Her paintings carry a quiet clarity—structured yet spacious—preserving classical order while leaving room for breath, silence, and contemplation.",
        "artist.stat1":"Years Devotion",
        "artist.stat2":"Global Exhibitions",
        "artist.stat3":"Private Collections",

        "gallery.label":"Curated Collection",
        "gallery.title":"Ink & Rhythm",
        "gallery.filter.all":"All Works",
        "gallery.filter.flower":"Flowers",
        "gallery.filter.animal":"Animals",
        "gallery.filter.bird_flower":"Birds & Flowers",

        "contact.title":"Acquire & Connect",
        "contact.desc":"For acquisition inquiries, commissions, or gallery representation, please reach out. I’d love to share the quiet beauty of Gongbi with you.",

        "form.name":"Your Name",
        "form.email":"Email Address",
        "form.message":"Inquiry / Message",
        "form.submit":"Send Inquiry",

        "footer.tagline":"Designed for the beauty of tranquility.",

        "auth.tip":"Tip: Please register first if you don’t have an account.",
        "auth.nicknote":"We store your email + nickname so the admin can manage users and show names in comments.",

        "admin.desc":"Enter the admin key to unlock upload / delete / edit controls.",
        "admin.addWork":"Add New Artwork",
        "admin.addTitle":"Add New Artwork",
        "admin.dragHint":"Drag & Drop Images Here (Storage)",
        "admin.publish":"Publish",

        "like":"Like",
        "comments.title":"Comments",
        "comments.post":"Post",
        "comments.loginTip":"Please sign in to comment."
      }
    };

    window.applyLanguage = () => {
      const btn = document.getElementById('lang-btn-text');
      const btnMobile = document.getElementById('lang-btn-text-mobile');
      if (btn) btn.innerText = currentLang === 'zh' ? 'EN' : '中';
      if (btnMobile) btnMobile.innerText = currentLang === 'zh' ? 'EN' : '中';

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (i18n[currentLang] && i18n[currentLang][key] != null) {
          el.innerHTML = i18n[currentLang][key];
        }
      });
      // Auth UI label (wired in Part 2)
      if (window.updateAuthUI) window.updateAuthUI();
    };

    window.toggleLanguage = () => {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      localStorage.setItem('huaqing_lang', currentLang);
      window.applyLanguage();
    };

    // modal helpers
    window.closeModalById = (id) => document.getElementById(id)?.classList.add('hidden');
    window.openAuthModal = (tab) => {
      document.getElementById('authModal')?.classList.remove('hidden');
      window.switchAuthTab(tab);
    };
    window.switchAuthTab = (tab) => {
      const loginForm = document.getElementById('form-login');
      const regForm = document.getElementById('form-register');
      const tabLogin = document.getElementById('tab-login');
      const tabReg = document.getElementById('tab-register');
      if (!loginForm || !regForm || !tabLogin || !tabReg) return;

      if (tab === 'login') {
        loginForm.classList.remove('hidden'); regForm.classList.add('hidden');
        tabLogin.classList.add('text-[#a83f39]','border-b-2'); tabLogin.classList.remove('text-stone-400');
        tabReg.classList.remove('text-[#a83f39]','border-b-2'); tabReg.classList.add('text-stone-400');
      } else {
        loginForm.classList.add('hidden'); regForm.classList.remove('hidden');
        tabReg.classList.add('text-[#a83f39]','border-b-2'); tabReg.classList.remove('text-stone-400');
        tabLogin.classList.remove('text-[#a83f39]','border-b-2'); tabLogin.classList.add('text-stone-400');
      }
    };

    // admin modal
    window.openAdminModal = () => document.getElementById('adminModal')?.classList.remove('hidden');

    // gallery placeholders until Firebase in Part 2/3
    window.filterGallery = (cat) => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('text-[#a83f39]','border-b','border-[#a83f39]'));
      const el = document.querySelector(`.filter-btn[data-filter="${cat}"]`);
      if (el) el.classList.add('text-[#a83f39]','border-b','border-[#a83f39]');
      // real render in Part 2
    };

    window.openAddModal = () => document.getElementById('addModal')?.classList.remove('hidden');
    window.closeArtworkModal = () => document.getElementById('imgModal')?.classList.add('hidden');

    // First paint i18n
    window.applyLanguage();
  </script>

  <!-- ========= PART 2/3 will be pasted below ========= -->
  <!-- Part 2: Firebase Auth + Firestore (users/comments/likes/artworks meta) -->
  <!-- Part 3: Firebase Storage (upload avatar / upload artwork images) -->
  <script type="module">
  /**
   * FINAL: Firebase Auth + Firestore + Storage (GitHub Pages friendly)
   * Project: qinghua-852c1
   *
   * Works:
   * - Email/password register & login
   * - Save user profile: email + nickname
   * - Likes & comments (login required)
   * - Admin unlock (key: qinghua666) => publish / status / delete / edit about video / see user list
   * - Upload artwork images to Storage (multi-image)
   * - Upload artist avatar to Storage (drag & drop)
   * - Delete artwork also deletes its Storage images (best effort)
   */

  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, doc, getDoc, setDoc, updateDoc, deleteDoc,
    query, orderBy, onSnapshot, serverTimestamp, increment, where, limit
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import {
    getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import {
    getStorage, ref as sRef, uploadBytes, getDownloadURL, deleteObject
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

  // ----------------------------
  // 0) Firebase config (yours)
  // ----------------------------
  const firebaseConfig = {
    apiKey: "AIzaSyBDvZ7oykdugl6DQH_p-0KOgy0sfMuMmFc",
    authDomain: "qinghua-852c1.firebaseapp.com",
    projectId: "qinghua-852c1",
    storageBucket: "qinghua-852c1.firebasestorage.app",
    messagingSenderId: "391709518256",
    appId: "1:391709518256:web:a18730b2d099c362e9ce75",
    measurementId: "G-8T36VSX6B6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const storage = getStorage(app);

  // ----------------------------
  // 1) Collections / Docs
  // ----------------------------
  const USERS = collection(db, "users");
  const ARTWORKS = collection(db, "artworks");
  const COMMENTS = collection(db, "comments");
  const SITE_CONFIG = doc(db, "site_config", "main");
  const ARTIST_PROFILE = doc(db, "artist_profile", "main");

  // ----------------------------
  // 2) Local state
  // ----------------------------
  let currentUser = null;
  let currentProfile = null;  // {email,nickname}
  let isAdmin = localStorage.getItem("hq_admin") === "true";
  let currentArtworkId = null;
  let currentArtworkData = null;

  // uploads for "Add artwork"
  let uploadQueueFiles = [];  // File[]
  let uploadPreviewURLs = []; // blob url for preview

  const getLang = () => localStorage.getItem("huaqing_lang") || "en";

  // ----------------------------
  // 3) DOM helpers
  // ----------------------------
  function $(id) { return document.getElementById(id); }
  function escapeHtml(str) {
    return String(str ?? "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function applyAdminUI() {
    if (isAdmin) {
      document.body.classList.add("is-admin");
      $("admin-badge")?.classList.remove("hidden");
      $("add-artwork-fab")?.classList.remove("hidden");
      $("artist-upload-hint")?.classList.remove("hidden");
      $("video-edit-btn")?.classList.remove("hidden");
    } else {
      document.body.classList.remove("is-admin");
      $("admin-badge")?.classList.add("hidden");
      $("add-artwork-fab")?.classList.add("hidden");
      $("artist-upload-hint")?.classList.add("hidden");
      $("video-edit-btn")?.classList.add("hidden");
      $("img-admin-edit-panel")?.classList.add("hidden");
    }
  }
  applyAdminUI();

  // safe modal close helper (works with your existing HTML)
  window.closeModalById = (id) => $(id)?.classList.add("hidden");

  // ----------------------------
  // 4) Auth UI hooks
  // ----------------------------
  window.updateAuthUI = () => {
    const nameEl = $("user-name-display");
    if (nameEl) {
      if (currentProfile?.nickname) {
        nameEl.innerText = currentProfile.nickname;
        nameEl.title = getLang()==="zh" ? "点击退出登录" : "Click to sign out";
      } else {
        nameEl.innerText = (getLang() === "zh" ? "登录/注册" : "Sign In");
        nameEl.title = "";
      }
    }

    const tip = $("comment-login-tip");
    const input = $("new-comment-input");
    const btn = document.querySelector('#comment-form-container button');

    if (!currentUser) {
      tip?.classList.remove("hidden");
      input?.setAttribute("disabled", "true");
      input?.classList.add("opacity-50");
      btn?.setAttribute("disabled", "true");
      btn?.classList.add("opacity-50");
    } else {
      tip?.classList.add("hidden");
      input?.removeAttribute("disabled");
      input?.classList.remove("opacity-50");
      btn?.removeAttribute("disabled");
      btn?.classList.remove("opacity-50");
    }
  };

  // click on user section: if logged in -> sign out, else open auth modal
  window.openAuthModal = (tab) => {
    $("authModal")?.classList.remove("hidden");
    window.switchAuthTab?.(tab || "login");
  };

  window.handleUserSectionClick = async () => {
    if (!currentUser) {
      window.openAuthModal("login");
      return;
    }
    if (confirm(getLang()==="zh" ? "退出登录？" : "Sign out?")) {
      await signOut(auth);
    }
  };

  window.authRegister = async () => {
    const nickname = $("reg-nickname")?.value?.trim();
    const email = $("reg-email")?.value?.trim();
    const password = $("reg-password")?.value;

    if (!nickname) return alert(getLang()==="zh" ? "请填写昵称" : "Please enter a nickname");
    if (!email || !email.includes("@")) return alert(getLang()==="zh" ? "请填写正确邮箱" : "Please enter a valid email");
    if (!password || password.length < 6) return alert(getLang()==="zh" ? "密码至少6位" : "Password must be 6+ chars");

    try {
      const cred = await createUserWithEmailAndPassword(auth, email, password);
      await setDoc(doc(db, "users", cred.user.uid), {
        email, nickname, createdAt: serverTimestamp()
      });
      alert(getLang()==="zh" ? "注册成功！" : "Registered!");
      window.closeModalById("authModal");
    } catch (e) {
      alert((getLang()==="zh" ? "注册失败：" : "Register failed: ") + e.message);
    }
  };

  window.authLogin = async () => {
    const email = $("login-email")?.value?.trim();
    const password = $("login-password")?.value;

    if (!email || !email.includes("@")) return alert(getLang()==="zh" ? "请填写正确邮箱" : "Please enter a valid email");
    if (!password) return alert(getLang()==="zh" ? "请输入密码" : "Please enter password");

    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert(getLang()==="zh" ? "登录成功！" : "Signed in!");
      window.closeModalById("authModal");
    } catch (e) {
      alert((getLang()==="zh" ? "登录失败：" : "Login failed: ") + e.message);
    }
  };

  onAuthStateChanged(auth, async (user) => {
    currentUser = user || null;
    currentProfile = null;

    if (currentUser) {
      const ref = doc(db, "users", currentUser.uid);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        currentProfile = snap.data();
      } else {
        currentProfile = { email: currentUser.email, nickname: currentUser.email?.split("@")[0] || "User" };
        await setDoc(ref, { ...currentProfile, createdAt: serverTimestamp() }, { merge: true });
      }
    }
    window.updateAuthUI();
  });

  // ----------------------------
  // 5) Admin
  // ----------------------------
  window.adminLogin = () => {
    const key = $("admin-key")?.value;
    if (key === "qinghua666") {
      isAdmin = true;
      localStorage.setItem("hq_admin", "true");
      applyAdminUI();
      $("admin-panel")?.classList.remove("hidden");
      $("admin-auth-form")?.classList.add("hidden");
      $("admin-dashboard")?.classList.remove("hidden");
      alert("Admin enabled ✅");
      if (currentArtworkId) $("img-admin-edit-panel")?.classList.remove("hidden");
    } else {
      alert(getLang()==="zh" ? "口令错误" : "Wrong key");
    }
  };

  window.openUserList = async () => {
    if (!isAdmin) return alert(getLang()==="zh" ? "仅管理员可查看" : "Admin only");
    const box = $("user-list");
    if (!box) return;
    box.classList.remove("hidden");
    box.innerHTML = "Loading...";
    const qy = query(USERS, orderBy("createdAt", "desc"), limit(200));
    const snap = await getDocs(qy);
    if (snap.empty) {
      box.innerHTML = "<div class='text-stone-500'>No users yet.</div>";
      return;
    }
    const rows = [];
    snap.forEach(d => {
      const u = d.data();
      rows.push(`<div class="flex justify-between border-b border-stone-200 py-1">
        <span><b>${escapeHtml(u.nickname || "")}</b> <span class="text-stone-500">(${escapeHtml(u.email || "")})</span></span>
      </div>`);
    });
    box.innerHTML = rows.join("");
  };

  // admin update about video url (Shorts supported) + loop embed
  window.adminEditAboutVideo = async () => {
    if (!isAdmin) return alert(getLang()==="zh" ? "仅管理员可操作" : "Admin only");
    const url = prompt("Enter YouTube video/shorts URL:", "https://www.youtube.com/shorts/zN0VzZRzlqM");
    if (!url) return;

    const id = extractYouTubeId(url);
    if (!id) return alert("Invalid YouTube URL");

    const embed = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1&loop=1&playlist=${id}&controls=0&playsinline=1&modestbranding=1&rel=0`;

    await setDoc(SITE_CONFIG, { aboutVideoUrl: embed, updatedAt: serverTimestamp() }, { merge: true });
    alert("Video updated ✅");
  };

  // ----------------------------
  // 6) Gallery realtime
  // ----------------------------
  const artworksQuery = query(ARTWORKS, orderBy("createdAt", "desc"));
  onSnapshot(artworksQuery, (snapshot) => {
    const all = [];
    snapshot.forEach(d => all.push({ id: d.id, ...d.data() }));
    if (all.length === 0) {
      seedDefaultArtworks().catch(console.error);
      return;
    }
    window.__allArtworks = all;
    const active = document.querySelector(".filter-btn.border-b")?.getAttribute("data-filter") || "all";
    renderGallery(active);
  });

  window.filterGallery = (cat) => {
    document.querySelectorAll('.filter-btn')
      .forEach(b => b.classList.remove('text-[#a83f39]','border-b','border-[#a83f39]'));
    const el = document.querySelector(`.filter-btn[data-filter="${cat}"]`);
    if (el) el.classList.add('text-[#a83f39]','border-b','border-[#a83f39]');
    renderGallery(cat);
  };

  function renderGallery(cat) {
    const grid = $("gallery-grid");
    if (!grid) return;

    const list = window.__allArtworks || [];
    const filtered = (cat === "all") ? list : list.filter(x => x.category === cat);

    grid.innerHTML = "";
    if (filtered.length === 0) {
      grid.innerHTML = `<div class="col-span-full text-center text-stone-500 py-16">${getLang()==="zh" ? "暂无作品" : "No artworks yet."}</div>`;
      return;
    }

    filtered.forEach(art => {
      const title = (getLang()==="zh") ? (art.title_zh || art.title_en || "") : (art.title_en || art.title_zh || "");
      const desc = (getLang()==="zh") ? (art.desc_zh || "") : (art.desc_en || "");
      const status = art.status || "Available";
      const mainImg = (art.images && art.images.length>0) ? art.images[0] : "";
      const statusClass =
        (status === "Sold") ? "bg-stone-700 text-stone-300" :
        (status === "Reserved") ? "bg-stone-500 text-white" :
        "bg-[#a83f39] text-white";

      const card = document.createElement("div");
      card.className = "group cursor-pointer break-inside-avoid mb-8 relative";

      card.innerHTML = `
        <div class="bg-white shadow-md rounded overflow-hidden relative">
          ${mainImg ? `<img src="${mainImg}" alt="${escapeHtml(title)}" class="w-full h-auto object-cover">`
                    : `<div class="w-full h-64 bg-stone-100 flex items-center justify-center text-stone-400">No Image</div>`}
          <div class="absolute inset-0 bg-black/0 hover:bg-black/20 transition-colors z-20 flex items-center justify-center">
            <span class="text-white border border-white px-6 py-2 tracking-widest text-sm font-song-art opacity-0 group-hover:opacity-100 transition-opacity">VIEW</span>
          </div>
        </div>
        <div class="mt-4 text-center">
          <h3 class="text-xl font-bold text-stone-800 font-serif">${escapeHtml(title)}</h3>
          <p class="text-stone-500 text-sm mt-1 font-serif italic">${escapeHtml(desc)}</p>
          <div class="mt-2 flex items-center justify-center gap-2">
            <span class="inline-block px-2 py-0.5 text-xs ${statusClass} font-sans uppercase tracking-widest">${status}</span>
          </div>
        </div>
      `;

      card.addEventListener("click", () => openArtworkModal(art));
      grid.appendChild(card);
    });

    lucide.createIcons();
  }

  async function openArtworkModal(art) {
    currentArtworkId = art.id;
    currentArtworkData = art;

    const container = $("modalImagesContainer");
    container.innerHTML = "";
    const imgs = (art.images && art.images.length>0) ? art.images : [];
    if (imgs.length === 0) {
      container.innerHTML = `<div class="text-stone-400 text-center py-12">No images</div>`;
    } else {
      imgs.forEach(src => {
        const img = document.createElement("img");
        img.src = src;
        img.className = "w-full h-auto object-contain shadow-2xl border-4 border-stone-800 mb-4";
        container.appendChild(img);
      });
    }

    const title = (getLang()==="zh") ? (art.title_zh || art.title_en || "") : (art.title_en || art.title_zh || "");
    const desc  = (getLang()==="zh") ? (art.desc_zh || "") : (art.desc_en || "");

    $("modalTitle").innerText = title;
    $("modalDesc").innerText = desc;
    $("modalStatus").innerText = art.status || "Available";
    $("likeCount").innerText = String(art.likes || 0);

    if (isAdmin) {
      $("img-admin-edit-panel")?.classList.remove("hidden");
      $("modal-status-select").value = art.status || "Available";
    } else {
      $("img-admin-edit-panel")?.classList.add("hidden");
    }

    subscribeComments(art.id);

    $("imgModal").classList.remove("hidden");
    document.body.style.overflow = "hidden";
    window.updateAuthUI();
  }

  window.closeArtworkModal = () => {
    $("imgModal")?.classList.add("hidden");
    document.body.style.overflow = "auto";
  };

  // ----------------------------
  // 7) Likes + Comments
  // ----------------------------
  window.toggleLike = async () => {
    if (!currentArtworkId) return;
    if (!currentUser) return alert(getLang()==="zh" ? "请先登录后点赞" : "Please sign in to like");

    try {
      await updateDoc(doc(db, "artworks", currentArtworkId), { likes: increment(1) });
      const now = Number($("likeCount").innerText || "0") + 1;
      $("likeCount").innerText = String(now);
    } catch (e) {
      alert("Like failed: " + e.message);
    }
  };

  let commentsUnsub = null;
  function subscribeComments(artworkId) {
    if (commentsUnsub) commentsUnsub();

    const listEl = $("comments-list");
    listEl.innerHTML = `<div class="text-stone-400 text-sm">Loading...</div>`;

    const qy = query(COMMENTS, where("artworkId", "==", artworkId), orderBy("createdAt", "desc"));
    commentsUnsub = onSnapshot(qy, (snap) => {
      listEl.innerHTML = "";
      if (snap.empty) {
        listEl.innerHTML = `<div class="text-stone-400 text-sm">${getLang()==="zh" ? "暂无评论" : "No comments yet."}</div>`;
        return;
      }
      snap.forEach(d => {
        const c = d.data();
        const div = document.createElement("div");
        div.className = "bg-stone-800 p-2 rounded text-sm";
        div.innerHTML = `<span class="text-[#a83f39] font-sans">${escapeHtml(c.nickname || "User")}:</span> ${escapeHtml(c.text || "")}`;
        listEl.appendChild(div);
      });
    });
  }

  window.postComment = async () => {
    if (!currentArtworkId) return;
    if (!currentUser) return alert(getLang()==="zh" ? "请先登录后评论" : "Please sign in to comment");

    const input = $("new-comment-input");
    const text = input.value.trim();
    if (!text) return;

    try {
      await addDoc(COMMENTS, {
        artworkId: currentArtworkId,
        uid: currentUser.uid,
        nickname: currentProfile?.nickname || "User",
        text,
        createdAt: serverTimestamp()
      });
      input.value = "";
    } catch (e) {
      alert("Comment failed: " + e.message);
    }
  };

  // ----------------------------
  // 8) Storage Upload (Artwork images + Artist avatar)
  // ----------------------------
  // A) Artwork upload handling (drop zone + file input)
  window.handleFiles = (files) => {
    uploadQueueFiles = [];
    clearPreviews();

    const arr = Array.from(files || []);
    const imgs = arr.filter(f => f.type.startsWith("image/"));
    if (imgs.length === 0) return;

    // limit to avoid crazy uploads
    const limited = imgs.slice(0, 10);

    limited.forEach(f => {
      uploadQueueFiles.push(f);
      const url = URL.createObjectURL(f);
      uploadPreviewURLs.push(url);
      addPreview(url);
    });
  };

  function addPreview(url) {
    const box = $("upload-previews");
    if (!box) return;
    const img = document.createElement("img");
    img.src = url;
    img.className = "h-full w-auto rounded border";
    box.appendChild(img);
  }

  function clearPreviews() {
    const box = $("upload-previews");
    if (box) box.innerHTML = "";
    uploadPreviewURLs.forEach(u => URL.revokeObjectURL(u));
    uploadPreviewURLs = [];
  }

  // Drop zone behavior
  const dropArea = $("drop-area");
  if (dropArea) {
    dropArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropArea.classList.add("dragover");
    });
    dropArea.addEventListener("dragleave", () => dropArea.classList.remove("dragover"));
    dropArea.addEventListener("drop", (e) => {
      e.preventDefault();
      dropArea.classList.remove("dragover");
      if (!isAdmin) return alert(getLang()==="zh" ? "仅管理员可上传作品" : "Admin only");
      window.handleFiles(e.dataTransfer.files);
    });
  }

  // File input hook
  const fileElem = $("fileElem");
  if (fileElem) {
    fileElem.addEventListener("change", () => {
      if (!isAdmin) return alert(getLang()==="zh" ? "仅管理员可上传作品" : "Admin only");
      window.handleFiles(fileElem.files);
    });
  }

  async function uploadArtworkImagesToStorage(files) {
    // returns array of {url, path}
    const results = [];
    for (const f of files) {
      const ext = (f.name.split(".").pop() || "jpg").toLowerCase();
      const safeExt = ["jpg","jpeg","png","webp","gif"].includes(ext) ? ext : "jpg";
      const path = `artworks/${Date.now()}_${Math.random().toString(16).slice(2)}.${safeExt}`;
      const r = sRef(storage, path);
      await uploadBytes(r, f, { contentType: f.type || "image/jpeg" });
      const url = await getDownloadURL(r);
      results.push({ url, path });
    }
    return results;
  }

  // B) Artist avatar drag & drop upload
  // Your HTML already has: ondrop="window.handleArtistDrop(event)" ondragover="event.preventDefault()"
  window.handleArtistDrop = async (e) => {
    e.preventDefault();
    if (!isAdmin) return alert(getLang()==="zh" ? "仅管理员可修改头像" : "Admin only");

    const file = e.dataTransfer.files?.[0];
    if (!file || !file.type.startsWith("image/")) return;

    try {
      const ext = (file.name.split(".").pop() || "jpg").toLowerCase();
      const safeExt = ["jpg","jpeg","png","webp"].includes(ext) ? ext : "jpg";
      const path = `artist/avatar.${safeExt}`;
      const r = sRef(storage, path);
      await uploadBytes(r, file, { contentType: file.type || "image/jpeg" });
      const url = await getDownloadURL(r);

      await setDoc(ARTIST_PROFILE, { photoUrl: url, photoPath: path, updatedAt: serverTimestamp() }, { merge: true });

      $("artist-img").src = url;
      alert(getLang()==="zh" ? "头像已更新✅" : "Avatar updated ✅");
    } catch (e2) {
      alert("Avatar upload failed: " + e2.message);
    }
  };

  // ----------------------------
  // 9) Admin: Publish / Status / Delete
  // ----------------------------
  window.publishArtwork = async () => {
    if (!isAdmin) return alert(getLang()==="zh" ? "仅管理员可发布" : "Admin only");

    const zh = $("new-title-zh")?.value?.trim();
    const en = $("new-title-en")?.value?.trim();
    const dzh = $("new-desc-zh")?.value?.trim();
    const den = $("new-desc-en")?.value?.trim();
    const cat = $("new-category")?.value;

    if (!zh && !en) return alert(getLang()==="zh" ? "请填写标题" : "Please enter a title");
    if (uploadQueueFiles.length === 0) return alert(getLang()==="zh" ? "请上传至少一张作品图" : "Please upload at least 1 image");

    // upload to Storage first
    try {
      const uploads = await uploadArtworkImagesToStorage(uploadQueueFiles);
      const urls = uploads.map(x => x.url);
      const paths = uploads.map(x => x.path);

      await addDoc(ARTWORKS, {
        title_zh: zh || en || "",
        title_en: en || zh || "",
        desc_zh: dzh || "",
        desc_en: den || "",
        category: cat || "flower",
        status: "Available",
        images: urls,
        imagePaths: paths, // for delete cleanup
        likes: 0,
        createdAt: serverTimestamp()
      });

      // reset add modal inputs
      clearPreviews();
      uploadQueueFiles = [];
      if (fileElem) fileElem.value = "";
      ["new-title-zh","new-title-en","new-desc-zh","new-desc-en"].forEach(id => { const el = $(id); if (el) el.value = ""; });

      window.closeModalById("addModal");
      alert(getLang()==="zh" ? "发布成功✅" : "Published ✅");
    } catch (e) {
      alert("Publish failed: " + e.message);
    }
  };

  window.updateArtworkStatus = async () => {
    if (!isAdmin) return alert("Admin only");
    if (!currentArtworkId) return;

    const status = $("modal-status-select").value;
    try {
      await updateDoc(doc(db, "artworks", currentArtworkId), { status });
      $("modalStatus").innerText = status;
      alert("Status updated ✅");
    } catch (e) {
      alert("Update failed: " + e.message);
    }
  };

  async function deleteStorageByPath(path) {
    try {
      if (!path) return;
      await deleteObject(sRef(storage, path));
    } catch {
      // best effort; ignore
    }
  }

  // delete artwork + delete its storage images best-effort
  window.deleteArtwork = async () => {
    if (!isAdmin) return alert("Admin only");
    if (!currentArtworkId) return;

    if (!confirm(getLang()==="zh" ? "确定永久删除该作品？" : "Delete this artwork permanently?")) return;

    try {
      // cleanup storage (if stored)
      const paths = currentArtworkData?.imagePaths || [];
      for (const p of paths) await deleteStorageByPath(p);

      await deleteDoc(doc(db, "artworks", currentArtworkId));

      window.closeArtworkModal();
      alert(getLang()==="zh" ? "已删除✅" : "Deleted ✅");
    } catch (e) {
      alert("Delete failed: " + e.message);
    }
  };

  // ----------------------------
  // 10) Load site config & artist profile
  // ----------------------------
  onSnapshot(SITE_CONFIG, (snap) => {
    if (!snap.exists()) return;
    const url = snap.data()?.aboutVideoUrl;
    const iframe = $("about-video-iframe");
    if (url && iframe) iframe.src = url;
  });

  onSnapshot(ARTIST_PROFILE, (snap) => {
    if (!snap.exists()) return;
    const photoUrl = snap.data()?.photoUrl;
    const img = $("artist-img");
    if (photoUrl && img) img.src = photoUrl;
  });

  // ----------------------------
  // 11) Seed demo data
  // ----------------------------
  async function seedDefaultArtworks() {
    const flagKey = "hq_seeded_once";
    if (localStorage.getItem(flagKey) === "true") return;
    localStorage.setItem(flagKey, "true");

    const seeds = [
      {
        title_zh: "《荷塘月色》",
        title_en: "Moonlit Lotus",
        desc_zh: "66cm × 66cm｜绢本设色",
        desc_en: "66cm × 66cm | Mineral pigment on silk",
        status: "Sold",
        category: "bird_flower",
        images: ["https://images.unsplash.com/photo-1599579634024-e9109033285e?q=80&w=2670&auto=format&fit=crop"],
        likes: 32
      },
      {
        title_zh: "《锦瑟年华》",
        title_en: "Golden Years",
        desc_zh: "45cm × 90cm｜纸本设色",
        desc_en: "45cm × 90cm | Color on paper",
        status: "Available",
        category: "flower",
        images: ["https://images.unsplash.com/photo-1535359056830-d4badde79747?q=80&w=2671&auto=format&fit=crop"],
        likes: 28
      },
      {
        title_zh: "《孔雀》",
        title_en: "Peacock",
        desc_zh: "水墨设色｜宣纸",
        desc_en: "Ink and color | Xuan paper",
        status: "Available",
        category: "animal",
        images: ["https://images.unsplash.com/photo-1502786932785-5c991e63d3fb?q=80&w=2535&auto=format&fit=crop"],
        likes: 22
      }
    ];

    for (const s of seeds) {
      await addDoc(ARTWORKS, { ...s, createdAt: serverTimestamp() });
    }
  }

  // ----------------------------
  // 12) YouTube shorts ID helper
  // ----------------------------
  function extractYouTubeId(url) {
    try {
      const u = new URL(url);
      if (u.hostname.includes("youtu.be")) return u.pathname.replace("/", "");
      if (u.hostname.includes("youtube.com")) {
        if (u.pathname.startsWith("/shorts/")) return u.pathname.split("/shorts/")[1]?.split("/")[0] || null;
        const v = u.searchParams.get("v");
        if (v) return v;
      }
      return null;
    } catch {
      return null;
    }
  }

  // ----------------------------
  // 13) Small wiring you may already have in HTML
  // ----------------------------
  // If your HTML has a user button calling openAuthModal, keep it.
  // But we also support clicking user area to sign out / sign in:
  // You can manually set your user-auth-section onclick="window.handleUserSectionClick()"
  // (Optional)
  const authSection = document.getElementById("user-auth-section");
  if (authSection) {
    authSection.addEventListener("click", (e) => {
      // avoid double if your button already opens modal
      const t = e.target?.closest("button");
      if (t && t.getAttribute("onclick")) return;
      window.handleUserSectionClick();
    });
  }

  // initial UI
  applyAdminUI();
  window.updateAuthUI();
</script>


</body>
</html>
